var t={};const e=Object.freeze({PLAYING_FIELD_SIZE:4,STATUS_IDLE:"idle",STATUS_PLAYING:"playing",STATUS_WIN:"win",STATUS_LOSE:"lose",EMPTY_PLAYING_FIELD:Object.freeze([[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]])});var s=(t={Game:class{constructor(t=e.EMPTY_PLAYING_FIELD){this.score=0,this.status=e.STATUS_IDLE,this.initialState=[],this.playingField=[];for(let s=0;s<e.PLAYING_FIELD_SIZE;s++){this.initialState[s]=[],this.playingField[s]=[];for(let l=0;l<e.PLAYING_FIELD_SIZE;l++)this.initialState[s][l]=t[s][l],this.playingField[s][l]=t[s][l]}}moveLeft(){if(this.getStatus()!==e.STATUS_PLAYING)return;let t=!0;for(let s=0;s<e.PLAYING_FIELD_SIZE;s++){let e=this.getRow(s),l=this.compactLine(e);this.areLinesEqual(e,l.compacted)||(t=!1,this.setRow(s,l.compacted),this.score+=l.score)}t||(this.populateRandomly(1),this.updateStatus())}moveRight(){if(this.getStatus()!==e.STATUS_PLAYING)return;let t=!0;for(let s=0;s<e.PLAYING_FIELD_SIZE;s++){let e=this.getRow(s),l=this.compactLine(e.reverse());this.areLinesEqual(e,l.compacted)||(t=!1,this.setRow(s,l.compacted.reverse()),this.score+=l.score)}t||(this.populateRandomly(1),this.updateStatus())}moveUp(){if(this.getStatus()!==e.STATUS_PLAYING)return;let t=!0;for(let s=0;s<e.PLAYING_FIELD_SIZE;s++){let e=this.getColumn(s),l=this.compactLine(e);this.areLinesEqual(e,l.compacted)||(t=!1,this.setColumn(s,l.compacted),this.score+=l.score)}t||(this.populateRandomly(1),this.updateStatus())}moveDown(){if(this.getStatus()!==e.STATUS_PLAYING)return;let t=!0;for(let s=0;s<e.PLAYING_FIELD_SIZE;s++){let e=this.getColumn(s),l=this.compactLine(e.reverse());this.areLinesEqual(e,l.compacted)||(t=!1,this.setColumn(s,l.compacted.reverse()),this.score+=l.score)}t||(this.populateRandomly(1),this.updateStatus())}getScore(){return this.score}getState(){let t=Array(e.PLAYING_FIELD_SIZE);for(let s=0;s<e.PLAYING_FIELD_SIZE;s++){t[s]=Array(e.PLAYING_FIELD_SIZE);for(let l=0;l<e.PLAYING_FIELD_SIZE;l++)t[s][l]=this.playingField[s][l]}return t}getStatus(){return this.status}start(){this.status=e.STATUS_PLAYING,this.score=0,this.populateRandomly(2)}restart(){for(let t=0;t<e.PLAYING_FIELD_SIZE;t++)for(let s=0;s<e.PLAYING_FIELD_SIZE;s++)this.playingField[t][s]=this.initialState[t][s];this.status=e.STATUS_IDLE,this.score=0}getColumn(t){let s=Array(e.PLAYING_FIELD_SIZE);for(let l=0;l<e.PLAYING_FIELD_SIZE;l++)s[l]=this.playingField[l][t];return s}setColumn(t,s){for(let l=0;l<e.PLAYING_FIELD_SIZE;l++)this.playingField[l][t]=s[l]}getRow(t){let s=Array(e.PLAYING_FIELD_SIZE);for(let l=0;l<e.PLAYING_FIELD_SIZE;l++)s[l]=this.playingField[t][l];return s}setRow(t,s){for(let l=0;l<e.PLAYING_FIELD_SIZE;l++)this.playingField[t][l]=s[l]}getCells(){return this.playingField.reduce((t,e)=>[...t,...e],[])}getIndexedCells(){return this.getCells().map((t,s)=>{let l=s%e.PLAYING_FIELD_SIZE;return{row:(s-l)/e.PLAYING_FIELD_SIZE,column:l,value:t}})}getCell(t,e){return this.playingField[t][e]}setCell(t,e,s){this.playingField[t][e]=s}populateRandomly(t){let e=this.getIndexedCells().filter(({value:t})=>0===t);for(let s=0;s<t&&0!==e.length;s++){let t=Math.floor(Math.random()*e.length),{row:s,column:l}=e[t];e.splice(t,1),this.setCell(s,l,this.generateCellValue())}}generateCellValue(){return Math.random()>.9?4:2}compactLine(t){let e=t.filter(t=>0!==t);if(e.length<2)return this.padWithZeros(e),{compacted:e,score:0};let s=[],l=0;for(let t=0;t<e.length;t++){let r=e[t];r===e[t+1]?(s.push(2*r),l+=2*r,t++):s.push(r)}return this.padWithZeros(s),{compacted:s,score:l}}areLinesEqual(t,s){for(let l=0;l<e.PLAYING_FIELD_SIZE;l++)if(t[l]!==s[l])return!1;return!0}padWithZeros(t){for(;t.length<e.PLAYING_FIELD_SIZE;)t.push(0);return t}updateStatus(){let t=this.getCells();t.some(t=>2048===t)?this.status=e.STATUS_WIN:function(t){if(t.some(t=>0===t))return!1;for(let s=0;s<e.PLAYING_FIELD_SIZE;s++)for(let l=0;l<e.PLAYING_FIELD_SIZE-1;l++)if(t[s*e.PLAYING_FIELD_SIZE+l]===t[s*e.PLAYING_FIELD_SIZE+(l+1)])return!1;for(let s=0;s<e.PLAYING_FIELD_SIZE-1;s++)for(let l=0;l<e.PLAYING_FIELD_SIZE;l++)if(t[s*e.PLAYING_FIELD_SIZE+l]===t[(s+1)*e.PLAYING_FIELD_SIZE+l])return!1;return!0}(t)&&(this.status=e.STATUS_LOSE)}},GAME_CONSTANTS:e}).Game,l=t.GAME_CONSTANTS;const r=new s;let i=!1;const a=document.querySelector(".game-score"),o=document.querySelector(".button.start"),I=document.querySelector(".message-start"),n=document.querySelector(".message-win"),L=document.querySelector(".message-lose"),c=[...document.querySelectorAll(".field-cell").values()],S=[];for(let t=0;t<l.PLAYING_FIELD_SIZE;t++){S[t]=Array(l.PLAYING_FIELD_SIZE);for(let e=0;e<l.PLAYING_FIELD_SIZE;e++)S[t][e]=c[t*l.PLAYING_FIELD_SIZE+e]}function E(){for(let t=0;t<l.PLAYING_FIELD_SIZE;t++)for(let e=0;e<l.PLAYING_FIELD_SIZE;e++){let s=S[t][e],l=r.getCell(t,e);for(let t=2;t<=2048;t*=2)s.classList.remove(`field-cell--${t}`);0===l?s.textContent="":(s.textContent=`${l}`,s.classList.add(`field-cell--${l}`))}a.textContent=r.getScore().toString()}S.forEach((t,e)=>{t.forEach((t,s)=>{t.addEventListener("click",()=>{(function(t,e){if(i){let s=r.getCell(t,e);0===s?r.setCell(t,e,2):2048===s?r.setCell(t,e,0):r.setCell(t,e,2*s),E()}})(e,s)})})}),o.addEventListener("click",function(){o.classList.contains("start")&&(o.classList.replace("start","restart"),o.textContent="Restart",I.classList.add("hidden")),n.classList.add("hidden"),L.classList.add("hidden"),r.restart(),r.start(),E()}),document.addEventListener("keydown",function(t){let e=!0;switch(t.key){case"ArrowRight":r.moveRight();break;case"ArrowLeft":r.moveLeft();break;case"ArrowUp":r.moveUp();break;case"ArrowDown":r.moveDown();break;case"F6":i=!i,console.log(`debug mode: ${i}`),e=!1;break;default:e=!1}if(e){switch(r.getStatus()){case l.STATUS_WIN:n.classList.remove("hidden");break;case l.STATUS_LOSE:L.classList.remove("hidden")}E()}});
//# sourceMappingURL=index.57e80549.js.map
