!function(){function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(t,r){if(t){if("string"==typeof t)return e(t,void 0);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e(t,void 0)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}for(var r={},n=Object.freeze({PLAYING_FIELD_SIZE:4,STATUS_IDLE:"idle",STATUS_PLAYING:"playing",STATUS_WIN:"win",STATUS_LOSE:"lose",EMPTY_PLAYING_FIELD:Object.freeze([[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]])}),a=(r={Game:/*#__PURE__*/function(){var e;function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.EMPTY_PLAYING_FIELD;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),this.score=0,this.status=n.STATUS_IDLE,this.initialState=[],this.playingField=[];for(var t=0;t<n.PLAYING_FIELD_SIZE;t++){this.initialState[t]=[],this.playingField[t]=[];for(var a=0;a<n.PLAYING_FIELD_SIZE;a++)this.initialState[t][a]=e[t][a],this.playingField[t][a]=e[t][a]}}return e=[{key:"moveLeft",value:function(){if(this.getStatus()===n.STATUS_PLAYING){for(var e=!0,t=0;t<n.PLAYING_FIELD_SIZE;t++){var r=this.getRow(t),a=this.compactLine(r);this.areLinesEqual(r,a.compacted)||(e=!1,this.setRow(t,a.compacted),this.score+=a.score)}e||(this.populateRandomly(1),this.updateStatus())}}},{key:"moveRight",value:function(){if(this.getStatus()===n.STATUS_PLAYING){for(var e=!0,t=0;t<n.PLAYING_FIELD_SIZE;t++){var r=this.getRow(t),a=this.compactLine(r.reverse());this.areLinesEqual(r,a.compacted)||(e=!1,this.setRow(t,a.compacted.reverse()),this.score+=a.score)}e||(this.populateRandomly(1),this.updateStatus())}}},{key:"moveUp",value:function(){if(this.getStatus()===n.STATUS_PLAYING){for(var e=!0,t=0;t<n.PLAYING_FIELD_SIZE;t++){var r=this.getColumn(t),a=this.compactLine(r);this.areLinesEqual(r,a.compacted)||(e=!1,this.setColumn(t,a.compacted),this.score+=a.score)}e||(this.populateRandomly(1),this.updateStatus())}}},{key:"moveDown",value:function(){if(this.getStatus()===n.STATUS_PLAYING){for(var e=!0,t=0;t<n.PLAYING_FIELD_SIZE;t++){var r=this.getColumn(t),a=this.compactLine(r.reverse());this.areLinesEqual(r,a.compacted)||(e=!1,this.setColumn(t,a.compacted.reverse()),this.score+=a.score)}e||(this.populateRandomly(1),this.updateStatus())}}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){for(var e=Array(n.PLAYING_FIELD_SIZE),t=0;t<n.PLAYING_FIELD_SIZE;t++){e[t]=Array(n.PLAYING_FIELD_SIZE);for(var r=0;r<n.PLAYING_FIELD_SIZE;r++)e[t][r]=this.playingField[t][r]}return e}},{key:"getStatus",value:function(){return this.status}},{key:"start",value:function(){this.status=n.STATUS_PLAYING,this.score=0,this.populateRandomly(2)}},{key:"restart",value:function(){for(var e=0;e<n.PLAYING_FIELD_SIZE;e++)for(var t=0;t<n.PLAYING_FIELD_SIZE;t++)this.playingField[e][t]=this.initialState[e][t];this.status=n.STATUS_IDLE,this.score=0}},{key:"getColumn",value:function(e){for(var t=Array(n.PLAYING_FIELD_SIZE),r=0;r<n.PLAYING_FIELD_SIZE;r++)t[r]=this.playingField[r][e];return t}},{key:"setColumn",value:function(e,t){for(var r=0;r<n.PLAYING_FIELD_SIZE;r++)this.playingField[r][e]=t[r]}},{key:"getRow",value:function(e){for(var t=Array(n.PLAYING_FIELD_SIZE),r=0;r<n.PLAYING_FIELD_SIZE;r++)t[r]=this.playingField[e][r];return t}},{key:"setRow",value:function(e,t){for(var r=0;r<n.PLAYING_FIELD_SIZE;r++)this.playingField[e][r]=t[r]}},{key:"getCells",value:function(){return this.playingField.reduce(function(e,r){return t(e).concat(t(r))},[])}},{key:"getIndexedCells",value:function(){return this.getCells().map(function(e,t){var r=t%n.PLAYING_FIELD_SIZE;return{row:(t-r)/n.PLAYING_FIELD_SIZE,column:r,value:e}})}},{key:"getCell",value:function(e,t){return this.playingField[e][t]}},{key:"setCell",value:function(e,t,r){this.playingField[e][t]=r}},{key:"populateRandomly",value:function(e){for(var t=this.getIndexedCells().filter(function(e){return 0===e.value}),r=0;r<e&&0!==t.length;r++){var n=Math.floor(Math.random()*t.length),a=t[n],i=a.row,o=a.column;t.splice(n,1),this.setCell(i,o,this.generateCellValue())}}},{key:"generateCellValue",value:function(){return Math.random()>.9?4:2}},{key:"compactLine",value:function(e){var t=e.filter(function(e){return 0!==e});if(t.length<2)return this.padWithZeros(t),{compacted:t,score:0};for(var r=[],n=0,a=0;a<t.length;a++){var i=t[a];i===t[a+1]?(r.push(2*i),n+=2*i,a++):r.push(i)}return this.padWithZeros(r),{compacted:r,score:n}}},{key:"areLinesEqual",value:function(e,t){for(var r=0;r<n.PLAYING_FIELD_SIZE;r++)if(e[r]!==t[r])return!1;return!0}},{key:"padWithZeros",value:function(e){for(;e.length<n.PLAYING_FIELD_SIZE;)e.push(0);return e}},{key:"updateStatus",value:function(){var e=this.getCells();e.some(function(e){return 2048===e})?this.status=n.STATUS_WIN:function(e){if(e.some(function(e){return 0===e}))return!1;for(var t=0;t<n.PLAYING_FIELD_SIZE;t++)for(var r=0;r<n.PLAYING_FIELD_SIZE-1;r++)if(e[t*n.PLAYING_FIELD_SIZE+r]===e[t*n.PLAYING_FIELD_SIZE+(r+1)])return!1;for(var a=0;a<n.PLAYING_FIELD_SIZE-1;a++)for(var i=0;i<n.PLAYING_FIELD_SIZE;i++)if(e[a*n.PLAYING_FIELD_SIZE+i]===e[(a+1)*n.PLAYING_FIELD_SIZE+i])return!1;return!0}(e)&&(this.status=n.STATUS_LOSE)}}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(r.prototype,e),r}(),GAME_CONSTANTS:n}).Game,i=r.GAME_CONSTANTS,o=new a,s=!1,l=document.querySelector(".game-score"),u=document.querySelector(".button.start"),c=document.querySelector(".message-start"),I=document.querySelector(".message-win"),f=document.querySelector(".message-lose"),L=t(document.querySelectorAll(".field-cell").values()),S=[],h=0;h<i.PLAYING_FIELD_SIZE;h++){S[h]=Array(i.PLAYING_FIELD_SIZE);for(var E=0;E<i.PLAYING_FIELD_SIZE;E++)S[h][E]=L[h*i.PLAYING_FIELD_SIZE+E]}function _(){for(var e=0;e<i.PLAYING_FIELD_SIZE;e++)for(var t=0;t<i.PLAYING_FIELD_SIZE;t++){for(var r=S[e][t],n=o.getCell(e,t),a=2;a<=2048;a*=2)r.classList.remove("field-cell--".concat(a));0===n?r.textContent="":(r.textContent="".concat(n),r.classList.add("field-cell--".concat(n)))}l.textContent=o.getScore().toString()}S.forEach(function(e,t){e.forEach(function(e,r){e.addEventListener("click",function(){(function(e,t){if(s){var r=o.getCell(e,t);0===r?o.setCell(e,t,2):2048===r?o.setCell(e,t,0):o.setCell(e,t,2*r),_()}})(t,r)})})}),u.addEventListener("click",function(){u.classList.contains("start")&&(u.classList.replace("start","restart"),u.textContent="Restart",c.classList.add("hidden")),I.classList.add("hidden"),f.classList.add("hidden"),o.restart(),o.start(),_()}),document.addEventListener("keydown",function(e){var t=!0;switch(e.key){case"ArrowRight":o.moveRight();break;case"ArrowLeft":o.moveLeft();break;case"ArrowUp":o.moveUp();break;case"ArrowDown":o.moveDown();break;case"F6":s=!s,console.log("debug mode: ".concat(s)),t=!1;break;default:t=!1}if(t){switch(o.getStatus()){case i.STATUS_WIN:I.classList.remove("hidden");break;case i.STATUS_LOSE:f.classList.remove("hidden")}_()}})}();
//# sourceMappingURL=index.69fae12c.js.map
